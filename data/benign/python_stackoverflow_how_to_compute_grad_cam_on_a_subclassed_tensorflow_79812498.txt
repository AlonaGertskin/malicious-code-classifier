# Example of encoder flow in call()
x1 = self.EncoderModule_1(inputs)   # 32 channels
x1p = self.pool1(x1)
x2 = self.EncoderModule_2(x1p)      # 64 channels
x2p = self.pool2(x2)
x3 = self.EncoderModule_3(x2p)      # 128 channels
...
x5 = self.EncoderModule_5(x4)       # 512 channels

# --- New Code Block --- 

# Output of decoder 1 
bone_mask = self.conv_1(x_decoder_4)
        
bone_mask = self.sigmoid_1(bone_mask)  

# Output of decoder 2 
lesion_mask = self.conv_2(x_decoder_8)
  

lesion_mask = self.sigmoid_2(lesion_mask)  

return {'bone_mask': bone_mask, 'lesion_mask': lesion_mask}

# --- New Code Block --- 

ValueError: Input 0 of layer "conv2d_105" is incompatible with the layer: 
expected axis 1 of input shape to have value 32, but received input with shape (1, 3, 256, 256)

# --- New Code Block --- 

ValueError: Attempt to convert a value (None) with an unsupported type (<class 'NoneType'>) to a Tensor.

# --- New Code Block --- 

encoder_input = tf.keras.Input(shape=(3,256,256))
x = model.EncoderModule_1(encoder_input)
x = model.pool1(x)
x = model.EncoderModule_2(x)
...
encoder_model = tf.keras.Model(inputs=encoder_input, outputs=x)

# --- New Code Block --- 

class FeatureExtractor(tf.keras.Model):
    def call(self, x):
        y = x
        for layer in model.layers:
            y = layer(y)
            if layer.name == "Encoder_Module_5":
                encoder_out = y
        outputs = model(x)
        return {"encoder": encoder_out, **outputs}
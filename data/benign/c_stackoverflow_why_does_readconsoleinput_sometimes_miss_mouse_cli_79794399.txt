#include <stdio.h>
#include <windows.h>
#include <pthread.h>

HANDLE consoleIn;

void *checkForClick( void *arg )
{
    for (;;)
    {
        INPUT_RECORD irInBuf[128];
        DWORD cNumRead;

        // read up to 128 events
        if ( ! ReadConsoleInput( consoleIn, irInBuf, 128, &cNumRead ) )
        {
            fprintf( stderr,  "Error in function ReadConsoleInput!\n" );
            ExitProcess( 0 );
        }

        // process one event per loop iteration
        for ( DWORD i = 0; i < cNumRead; i++ )
        {
            if ( irInBuf[i].EventType == MOUSE_EVENT )
            {
                MOUSE_EVENT_RECORD *pme = &irInBuf[i].Event.MouseEvent;

                switch ( pme->dwEventFlags )
                {
                    case 0:
                        if ( pme->dwButtonState & FROM_LEFT_1ST_BUTTON_PRESSED )
                        {
                            printf( "Left pressed\n" );
                            fflush( stdout );
                        }
                }
            }
        }
    }
    Sleep(50);
}

int main(){
    consoleIn = GetStdHandle(STD_INPUT_HANDLE);
    DWORD fdwMode = (ENABLE_WINDOW_INPUT | ENABLE_MOUSE_INPUT | ENABLE_EXTENDED_FLAGS) & ~ENABLE_QUICK_EDIT_MODE;
    SetConsoleMode(consoleIn, fdwMode);






    printf("The program has begun.\n");

    pthread_t thread1;
    pthread_create(&thread1, NULL, checkForClick, NULL);
    pthread_join(thread1, NULL);

    printf("The thread for the function has been created");
}
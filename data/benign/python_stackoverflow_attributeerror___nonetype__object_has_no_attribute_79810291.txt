import gradio as gr
import requests
from smolagents import tool
from smolagents import CodeAgent, InferenceClientModel, tool
 
@tool
def getHelloName(input:str)-> str:
    """
    This tool returns the hello name

    Args:
        input: A search term 
    """

    url = f"http://localhost:9100/v3/rest/helloWorld/{input}"

    # case when there is a response from the API
    try:
        
        response = requests.get(url)
        if response.status_code == 200: # excpected, okay status code
            # parsing status code
            helloName = response.json()['message']
            return helloName
        else:
            # in case of an unfavorable status code
            return "Name could not be fetched"
    except requests.exceptions.RequestException as e:
        return "Exception...Name could not be fetched"

def getHelloNameFn(message, history)-> str:
    agent = CodeAgent(tools=[getHelloName], model=InferenceClientModel())   
    result = agent.run(message)
    print(result)

gr.ChatInterface(
    fn=getHelloNameFn, 
    type="messages"   #Always set type="messages" in gr.ChatInterface.
).launch()
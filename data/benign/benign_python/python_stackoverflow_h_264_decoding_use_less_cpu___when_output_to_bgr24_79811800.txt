def decode_video_pyav(file_path, in_q: Queue, decoder_threads: int):
    """Decode videos and push frames to queue. Sends sentinel for each worker."""
    images_count = 0
    container = av.open(file_path)
    video_stream = container.streams.video[0]
    video_stream.codec_context.thread_count = decoder_threads  # or 0: auto
    video_stream.codec_context.thread_type = "AUTO"
    
    print(f"[DECODER] Set codec threads to {video_stream.codec_context.thread_count}")

    try:
        for frame in container.decode(video_stream):
            # print(frame.format.name)
            img = frame.to_ndarray(format='bgr24')
            # img = frame.to_ndarray(format='yuv420p')
            images_count += 1
    finally:
        container.close()
        print(f"[DECODER] Finished decoding {images_count} frames from {file_path}")